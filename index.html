<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Baby Keyboard Smash Game!</title>
  <meta name="description" content="A keyboard smash videogame for babies. Animations such as fireworks will appear when keys are pressed.">
  <meta name="author" content="Kevin Wheeler">
  <meta property="og:image" content="https://drive.google.com/uc?id=1JyfaOiFkPqOKJ3q_f0hcU8wKZp_B9eok" />
  <meta property="og:description" content="A keyboard smash videogame for babies. Animations such as fireworks will appear when keys are pressed." />
  <meta name="google-site-verification" content="Y3-tHUYAJjAt6c7LPTxLIeDfd8liwzBzpe3uqvTJbco" />
  <style>
    body { margin: 0; }
  </style>
</head>
<body>
<canvas id='kmw-background-canvas' style="position:fixed;touch-action: none"></canvas>
<canvas id='s' style="position:fixed;touch-action: none"></canvas>
<canvas id="canvas" style="position:fixed;touch-action: none"></canvas>

<script>
  // Global sound variables
  var snd = new Audio("firework-sound.mp3");

  const soundSections = [
      { start: 0.0, end: 17.193 },
      { start: 17.193, end: 34.386 },
      { start: 34.386, end: 51.579 },
      { start: 51.579, end: 68.772 },
      { start: 68.772, end: 85.965 }
  ];

  // Function to play a random sound from the firework clip
  function playRandomSound() {
      const randomSection = soundSections[Math.floor(Math.random() * soundSections.length)];
      snd.currentTime = randomSection.start; // Start playing from a random section
      snd.play();
      setTimeout(() => {
          snd.pause();
      }, (randomSection.end - randomSection.start) * 1000); // Stop after the section ends
  }

  // Firework and particle setup
  var canvas = document.getElementById('canvas'),
      ctx2 = canvas.getContext('2d'),
      cw = window.innerWidth,
      ch = window.innerHeight,
      particles = [],
      hue = 120;

  canvas.width = cw;
  canvas.height = ch;

  // Particle class
  function Particle(x, y) {
      this.x = x;
      this.y = y;
      this.coordinates = [];
      this.coordinateCount = 5;
      while (this.coordinateCount--) {
          this.coordinates.push([this.x, this.y]);
      }
      this.angle = random(0, Math.PI * 2);
      this.speed = random(1, 10);
      this.friction = 0.95;
      this.gravity = 1;
      this.hue = random(hue - 50, hue + 50);
      this.brightness = random(50, 80);
      this.alpha = 1;
      this.decay = random(0.015, 0.03);
  }

  Particle.prototype.update = function (index) {
      this.coordinates.pop();
      this.coordinates.unshift([this.x, this.y]);
      this.speed *= this.friction;
      this.x += Math.cos(this.angle) * this.speed;
      this.y += Math.sin(this.angle) * this.speed + this.gravity;
      this.alpha -= this.decay;

      if (this.alpha <= this.decay) {
          particles.splice(index, 1);
      }
  };

  Particle.prototype.draw = function () {
      ctx2.beginPath();
      ctx2.moveTo(this.coordinates[this.coordinates.length - 1][0], this.coordinates[this.coordinates.length - 1][1]);
      ctx2.lineTo(this.x, this.y);
      ctx2.strokeStyle = 'hsla(' + this.hue + ', 100%, ' + this.brightness + '%, ' + this.alpha + ')';
      ctx2.stroke();
  };

  function createParticles(x, y) {
      var particleCount = 30;
      while (particleCount--) {
          particles.push(new Particle(x, y));
      }
  }

  // Main animation loop
  function loop() {
      ctx2.clearRect(0, 0, cw, ch);
      ctx2.globalCompositeOperation = 'lighter';
      var i = particles.length;
      while (i--) {
          particles[i].draw();
          particles[i].update(i);
      }
      requestAnimationFrame(loop);
  }

  // Utilities
  function random(min, max) {
      return Math.random() * (max - min) + min;
  }

  // Event listeners for fireworks and sound
  document.addEventListener("keydown", function () {
      createParticles(Math.random() * cw, Math.random() * 0.5 * ch);
      playRandomSound(); // Play sound
  });

  document.addEventListener("mousedown", function (e) {
      createParticles(e.clientX, e.clientY);
      playRandomSound(); // Play sound
  });

  document.addEventListener("touchstart", function (e) {
      for (let i = 0; i < e.touches.length; ++i) {
          let touch = e.touches.item(i);
          createParticles(touch.clientX, touch.clientY);
          playRandomSound(); // Play sound
      }
  });

  window.addEventListener('resize', function () {
      cw = window.innerWidth;
      ch = window.innerHeight;
      canvas.width = cw;
      canvas.height = ch;
  });

  window.addEventListener('load', loop, false);
</script>
</body>
</html>
