<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Baby Keyboard Smash Game!</title>
  <meta name="description" content="A keyboard smash videogame for babies. Animations such as fireworks will appear when keys are pressed.">
  <meta name="author" content="Kevin Wheeler">
  <meta property="og:image" content="https://drive.google.com/uc?id=1JyfaOiFkPqOKJ3q_f0hcU8wKZp_B9eok" />
  <meta property="og:description" content="A keyboard smash videogame for babies. Animations such as fireworks will appear when keys are pressed." />
  <meta name="google-site-verification" content="Y3-tHUYAJjAt6c7LPTxLIeDfd8liwzBzpe3uqvTJbco" />
  <style>
    body { margin: 0; }
  </style>
</head>

<body>
<canvas id='kmw-background-canvas' style="position:fixed;touch-action: none"></canvas>
<canvas id='s' style="position:fixed;touch-action: none"></canvas>
<canvas id="canvas" style="position:fixed;touch-action: none"></canvas>

<script>
  // ==============================
  // New Code: Global Sound Variables
  // ==============================
  var snd = new Audio("firework-sound.mp3");

  const soundSections = [
      { start: 0.0, end: 17.193 },
      { start: 17.193, end: 34.386 },
      { start: 34.386, end: 51.579 },
      { start: 51.579, end: 68.772 },
      { start: 68.772, end: 85.965 }
  ];

  function playRandomSound() {
      const randomSection = soundSections[Math.floor(Math.random() * soundSections.length)];
      snd.currentTime = randomSection.start; // Start playing from a random section
      snd.play();
      setTimeout(() => {
          snd.pause();
      }, (randomSection.end - randomSection.start) * 1000); // Stop after the section ends
  }

  // ==============================
  // Existing Canvas Resize Logic
  // ==============================
  window.addEventListener('resize', function (event) {
      var canvases = document.querySelectorAll('canvas');
      var canvas_array = [...canvases];
      canvas_array.forEach(canvas => {
          canvas.width = window.innerWidth;
          canvas.height = window.innerHeight;
      });
  }, true);

  // Existing Canvas Setup Code
  var canvas = document.getElementById('canvas'),
      ctx2 = canvas.getContext('2d'),
      cw = window.innerWidth,
      ch = window.innerHeight,
      particles = [],
      hue = 120;

  canvas.width = cw;
  canvas.height = ch;

  function createParticles(x, y) {
      var particleCount = 30;
      while (particleCount--) {
          particles.push(new Particle(x, y));
      }
  }

  // ==============================
  // Updated Event Listeners
  // ==============================
  document.addEventListener("keydown", function () {
      createParticles(Math.random() * cw, Math.random() * 0.5 * ch);
      playRandomSound(); // Trigger sound
  });

  document.addEventListener("mousedown", function (e) {
      createParticles(e.clientX, e.clientY);
      playRandomSound(); // Trigger sound
  });

  document.addEventListener("touchstart", function (e) {
      for (let i = 0; i < e.touches.length; ++i) {
          let touch = e.touches.item(i);
          createParticles(touch.clientX, touch.clientY);
          playRandomSound(); // Trigger sound
      }
  });

  // ==============================
  // Existing Animation Loop
  // ==============================
  function loop() {
      ctx2.clearRect(0, 0, cw, ch);
      ctx2.globalCompositeOperation = 'lighter';
      var i = particles.length;
      while (i--) {
          particles[i].draw();
          particles[i].update(i);
      }
      requestAnimationFrame(loop);
  }

  window.addEventListener('load', loop, false);
</script>
</body>
</html>
